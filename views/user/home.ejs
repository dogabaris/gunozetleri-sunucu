<html lang="UTF-8">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />

<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment-with-locales.min.js"></script>

<script>
$( function() {
  var dialog, form,

    emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,
    title = $( "#title" ),
    news = $( "#news" ),
    image = $( "#image" ),
    date = $( "#date" ).find("input"),
    allFields = $( [] ).add( title ).add( news ).add( image ).add( date ),
    tips = $( ".svalidateTips" );


  function Validate()
  {
      var msg= "",
          fields = document.getElementById("dialog-form").querySelectorAll('input, textarea');

      for (var i=0; i<fields.length; i++){
          if (fields[i].value == "")
              msg += fields[i].name + ' boş bırakıldı. \n';
      }

      if(msg) {
          alert(msg);
          return false;
      }
      else
          return true;
  }

  function ozetEkle() {

     if(Validate()){

       event.preventDefault();
       var formData = new FormData($("#dialog-data")[0]);

       $.ajax({
        url: '/home/new',
        type: 'POST',
        data: formData,
        async: false,
        cache: false,
        contentType: false,
        processData: false,
        success: function (returndata) {
          alert( "Data Loaded: " + returndata );

          $( "#tablo tbody" ).append( "<tr>" +
            "<td>" + title.val() + "</td>" +
            "<td>" + news.val() + "</td>" +
            "<td>" + image.val() + "</td>" +
            "<td>" + date.val() + "</td>" +
            "<td>" + "Beklemede" + "</td>" +
            "<td>" + <%= req.session.me %> + "</td>" +
            "<td>" + '<a href="#" class="btn btn-info btn-sm"><span class="glyphicon glyphicon-edit">' + "</td>" +
          "</tr>" );
          dialog.dialog( "close" );
        },
        error: function(er){
          alert( "Gönderilemedi!" );
        }

      });


       /*$.post(  "/home/new", { title: baslik.val(), news: haber.val(), imagePath: gorsel.val(), date: tarih.val(), state: "Beklemede", who: <%= req.session.me %> })
        .done(function( data ) {
         alert( "Data Loaded: " + data );
       });*/


      }

  }

  dialog = $( "#dialog-form" ).dialog({
    autoOpen: false,
    height: 400,
    width: 350,
    modal: true,
    buttons: {
      "Yayınla": ozetEkle,
      Kapat: function() {
        dialog.dialog( "close" );
      }
    },
    close: function() {
      form[ 0 ].reset();
    }
  });

  form = dialog.find( "form" ).on( "submit", function( event ) {
    event.preventDefault();
    ozetEkle();
  });

  $( "#yenibutton" ).button().on( "click", function() {
    dialog.dialog( "open" );
  });

} );
</script>

</script>

<script type="text/javascript">
  $(document).ready(function() {
        $(function () {

            $('#date').datetimepicker({
                useCurrent: true,
                format: 'D/MM/YYYY HH:mm',
                locale: 'tr'
            });

        });
  });
</script>

</head>

<body>


  <nav class="navbar navbar-default">
    <div class="container-fluid">

      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu-div" aria-expanded="false">
          <span class="sr-only">Menü</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Gün Özetleri</a>
      </div>

      <div class="collapse navbar-collapse" id="menu-div">
        <ul class="nav navbar-nav">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Menü <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="#">Menu1</a></li>
              <li><a href="#">Menu2</a></li>
              <li><a href="#">Menu3</a></li>
              <li role="separator" class="divider"></li>
              <li><a href="/logout">Çıkış</a></li>
            </ul>
          </li>
          <li class="active"><a href="#" id="yenibutton">Yeni<span class="sr-only">(current)</span></a></li>
          <li><a href="#">İstatistik</a></li>
        </ul>
        <form class="navbar-form navbar-right">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="">
          </div>
          <button type="submit" class="btn btn-default">Ara</button>
        </form>
      </div>

    </div>
  </nav>

<div id="tablo-div" class="ui-widget">

  <table id="tablo" cellspacing="0" width="100%" class="table table-striped">
    <thead>
      <tr>
        <th>Başlık</th>
        <th>Haber</th>
        <th>Görsel</th>
        <th>Tarih</th>
        <th>Durum</th>
        <th>Ekleyen</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% News.forEach(function(New){ %>
      <tr>
        <td><%= New.title %></td>
        <td><%= New.news %></td>
        <td><img src="<%= New.imagePath %>" alt="><%= New.imagePath %>"><%= New.imagePath %></td>
        <td><%= New.date %></td>
        <td><%= New.state %></td>
        <td><%= New.who %></td>
        <td><a href="#" class="btn btn-info btn-sm"><span class="glyphicon glyphicon-edit"></span></a><td>
      </tr>
      <% }); %>
    </tbody>
  </table>
</div>

<div id="dialog-form" title="Yeni Özet" hidden="hidden" >
  <p class="validateTips">Alanlar doldurulmalıdır.</p>

  <form id="dialog-data" action="file/upload" method="post" enctype="multipart/form-data">
     <div class="form-group">
      <label for="title">Başlık</label>
      <input type="text" name="title" id="title" class="form-control" >
    </div>
    <div class="form-group">
      <label for="news">Haber</label>
      <textarea class="form-control" rows="5" name="news" id="news" ></textarea>
    </div>
    <div class="form-group">
      <label for="image">Görsel</label>
      <input type="file" id="image" name="image" />
    </div>
    <div class="form-group">
      <label for="date">Tarih</label>
      <div class='input-group date' id='date'>
          <input type='text' name='date' class="form-control" />
            <span class="input-group-addon">
                <span class="glyphicon glyphicon-calendar" ></span>
            </span>
      </div>
    </div>
    <div class="form-group">
      <label for="state">Durum</label>
      <input readonly class="form-control" type="text" name="state" id="state" value="Beklemede"/>
    </div>
    <div class="form-group">
      <label for="who">Ekleyen</label>
      <input readonly type="text" class="form-control" name="who" id="who" value="<%= req.session.me %>" />
    </div>
      <button type="submit" tabindex="-1" style="position:absolute; top:-1000px">Gönder</button>
  </form>
</div>


<!--SCRIPTS-->
<script src="/js/dependencies/sails.io.js"></script>
<script src="/js/dependencies/jquery-ui.min.js"></script>
<script src="/js/dependencies/bootstrap.min.js"></script>
<script src="/js/dependencies/bootstrap-datetimepicker.min.js"></script>
<!--SCRIPTS END-->



</body>
</html>
